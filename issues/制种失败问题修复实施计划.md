# 制种失败问题修复实施计划 v1.9.15

## 问题分析

### 问题1：Tracker URL格式错误
- **错误现象**：`-a ' `https://tracker.qingwapt.org` '`（URL被加上了反引号）
- **根本原因**：`_load_trackers` 方法读取 `trackers.txt` 时可能引入了格式问题
- **影响**：导致 mktorrent 命令执行失败

### 问题2：文件名冲突
- **错误现象**：多个任务生成相同的输出文件名 `_root_pack_20250627_090411.torrent`
- **根本原因**：时间戳精度只到秒级（`%Y%m%d_%H%M%S`），并发任务产生相同文件名
- **影响**：文件已存在错误，制种失败

## 修复方案

### 步骤1：修复 Tracker URL 处理
**文件**：`torrent_maker.py`
**位置**：`_load_trackers` 方法（第2346行）
**修改内容**：
1. 增强URL格式验证和清理
2. 移除可能的反引号和其他非法字符
3. 添加URL格式验证

### 步骤2：改进时间戳精度
**文件**：`torrent_maker.py`
**位置**：第4797行和6189行
**修改内容**：
1. 将时间戳格式从 `%Y%m%d_%H%M%S` 改为 `%Y%m%d_%H%M%S_%f`（添加微秒）
2. 或者使用UUID确保文件名唯一性

### 步骤3：添加文件冲突检测
**文件**：`torrent_maker.py`
**位置**：`_create_torrent_mktorrent` 方法
**修改内容**：
1. 在创建文件前检查文件是否存在
2. 如果存在，自动生成新的文件名
3. 添加重试机制

### 步骤4：更新版本号
**文件**：`torrent_maker.py`
**位置**：第132行
**修改内容**：
1. 将版本号从 `v1.9.14` 更新为 `v1.9.15`
2. 添加版本更新说明

### 步骤5：创建BUGFIX文档
**文件**：`BUGFIX_v1.9.15.md`
**内容**：记录本次修复的详细信息

### 步骤6：提交代码
1. 提交修复到本地仓库
2. 推送到远程仓库
3. 创建release标签

## 预期结果

1. **Tracker URL格式正确**：`-a 'https://tracker.qingwapt.org'`
2. **文件名唯一性**：`_root_pack_20250627_090411_123456.torrent`
3. **制种成功率提升**：解决文件冲突和URL格式问题
4. **系统稳定性增强**：添加错误处理和重试机制

## 风险评估

- **低风险**：修改仅涉及错误处理和格式优化
- **向后兼容**：不影响现有功能
- **测试覆盖**：修改后需要进行完整测试

## 实施时间

预计实施时间：30-45分钟
- 代码修改：20分钟
- 测试验证：15分钟
- 文档更新：10分钟