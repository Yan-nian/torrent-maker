# 远程文件浏览器功能实施计划 v2.2.0

## 任务概述
为torrent-maker Web界面的创建种子页面添加远程文件浏览功能，支持：
- 远程服务器文件列表获取和选择
- 文件夹内容数量统计
- 剧集信息智能识别
- 增强的用户交互体验

## 技术方案
基于现有SSHServerManager扩展，实现增强型文件浏览器

## 详细实施步骤

### 第一阶段：后端API开发

#### 1. 扩展SSHServerManager类
**文件：** `web_app.py`
**函数/类：** `SSHServerManager`
**逻辑概要：**
- 添加`browse_directory(server_id, path)`方法
- 添加`get_directory_stats(server_id, path)`方法
- 添加`parse_episode_info(filename)`方法
- 实现文件类型识别和统计功能

**预期结果：** SSH管理器支持文件浏览和统计功能

#### 2. 新增文件浏览API接口
**文件：** `web_app.py`
**函数/类：** 新增路由函数
**逻辑概要：**
- `GET /api/servers/{server_id}/browse?path={path}` - 获取目录内容
- `GET /api/servers/{server_id}/stats?path={path}` - 获取目录统计
- 返回JSON格式的文件列表和统计信息

**预期结果：** 提供完整的文件浏览REST API

#### 3. 剧集信息解析器
**文件：** `web_app.py`
**函数/类：** `EpisodeParser`类
**逻辑概要：**
- 正则表达式匹配S01E01、1x01等格式
- 提取季数、集数、标题信息
- 支持常见命名规范识别

**预期结果：** 智能识别视频文件的剧集信息

### 第二阶段：前端界面开发

#### 4. 创建种子页面UI增强
**文件：** `web/templates/index.html`
**函数/类：** 创建种子表单区域
**逻辑概要：**
- 在源文件路径输入框旁添加"浏览远程文件"按钮
- 创建文件浏览器模态框组件
- 实现面包屑导航和文件列表展示

**预期结果：** 用户可通过按钮打开文件浏览器

#### 5. 文件浏览器组件
**文件：** `web/static/js/file-browser.js`（新建）
**函数/类：** `FileBrowser`类
**逻辑概要：**
- 文件树展示和导航功能
- 文件夹统计信息显示
- 剧集信息标签展示
- 文件选择和路径回填功能

**预期结果：** 完整的文件浏览器交互组件

#### 6. 样式和交互优化
**文件：** `web/static/css/style.css`
**函数/类：** CSS样式规则
**逻辑概要：**
- 文件浏览器模态框样式
- 文件类型图标和剧集标签样式
- 响应式布局适配

**预期结果：** 美观的文件浏览器界面

### 第三阶段：功能集成测试

#### 7. 创建测试脚本
**文件：** `test_file_browser.py`（新建）
**函数/类：** 测试函数集合
**逻辑概要：**
- 测试SSH文件浏览功能
- 测试剧集信息解析
- 测试API接口响应

**预期结果：** 验证所有功能正常工作

#### 8. 版本更新
**文件：** `torrent_maker.py`, `web_app.py`
**函数/类：** 版本号常量
**逻辑概要：**
- 更新版本号至v2.2.0
- 更新功能描述和变更日志

**预期结果：** 版本信息正确更新

## 技术依赖
- 现有：paramiko（SSH连接）
- 现有：Flask（Web框架）
- 现有：Bootstrap（UI框架）

## 预期交付物
1. 增强的SSHServerManager类
2. 文件浏览API接口
3. 剧集信息解析器
4. 文件浏览器前端组件
5. 测试脚本和文档
6. 版本v2.2.0发布

## 风险评估
- **低风险：** 基于现有SSH架构扩展
- **中风险：** 大文件夹浏览性能问题
- **缓解措施：** 实现分页和缓存机制

---
**创建时间：** 2024年当前时间
**预计完成时间：** 1-2小时
**负责人：** AI编程助手